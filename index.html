<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Photo Editor</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    canvas {
      border: 1px solid #ccc;
      display: block;
      margin-bottom: 10px;
    }
    .controls input[type=range] {
      width: 100%;
    }
    .control-group {
      margin-bottom: 10px;
    }
    .buttons button {
      margin-right: 5px;
    }
    .tone-curve {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }
    .tone-curve label {
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>Simple Photo Editor</h1>
  <input type="file" id="upload" accept="image/*" />
  <canvas id="canvas"></canvas>

  <div class="controls">
    <div class="control-group">
      <label>Brightness</label>
      <input type="range" id="brightness" min="-100" max="100" value="0" />
    </div>
    <div class="control-group">
      <label>Contrast</label>
      <input type="range" id="contrast" min="-100" max="100" value="0" />
    </div>
    <div class="control-group">
      <label>Exposure</label>
      <input type="range" id="exposure" min="-100" max="100" value="0" />
    </div>
    <div class="tone-curve">
      <label>Red Curve</label>
      <input type="range" id="curveR" min="-100" max="100" value="0">
      <label>Green Curve</label>
      <input type="range" id="curveG" min="-100" max="100" value="0">
      <label>Blue Curve</label>
      <input type="range" id="curveB" min="-100" max="100" value="0">
    </div>
  </div>

  <div class="buttons">
    <button onclick="resetEdits()">Reset</button>
    <button onclick="exportImage('jpeg')">Export JPEG</button>
    <button onclick="exportImage('png')">Export PNG</button>
    <button onclick="toggleBeforeAfter()">Before/After</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const upload = document.getElementById('upload');
    let originalImage = null;
    let image = new Image();

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        image.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    image.onload = function () {
      canvas.width = image.width;
      canvas.height = image.height;
      ctx.drawImage(image, 0, 0);
      originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
    };

    function resetEdits() {
      if (originalImage) ctx.putImageData(originalImage, 0, 0);
    }

    function toggleBeforeAfter() {
      if (originalImage) {
        const current = ctx.getImageData(0, 0, canvas.width, canvas.height);
        ctx.putImageData(originalImage, 0, 0);
        originalImage = current;
      }
    }

    function exportImage(type) {
      const link = document.createElement('a');
      link.download = `edited-image.${type}`;
      link.href = canvas.toDataURL(`image/${type}`);
      link.click();
    }

    document.getElementById('brightness').addEventListener('input', applyEdits);
    document.getElementById('contrast').addEventListener('input', applyEdits);
    document.getElementById('exposure').addEventListener('input', applyEdits);
    document.getElementById('curveR').addEventListener('input', applyEdits);
    document.getElementById('curveG').addEventListener('input', applyEdits);
    document.getElementById('curveB').addEventListener('input', applyEdits);

    function applyEdits() {
      if (!originalImage) return;
      const brightness = parseInt(document.getElementById('brightness').value);
      const contrast = parseInt(document.getElementById('contrast').value);
      const exposure = parseInt(document.getElementById('exposure').value);
      const curveR = parseInt(document.getElementById('curveR').value);
      const curveG = parseInt(document.getElementById('curveG').value);
      const curveB = parseInt(document.getElementById('curveB').value);

      const imageData = new ImageData(new Uint8ClampedArray(originalImage.data), originalImage.width, originalImage.height);
      const data = imageData.data;

      for (let i = 0; i < data.length; i += 4) {
        // Brightness, contrast, exposure adjustments
        for (let j = 0; j < 3; j++) {
          let val = data[i + j];
          val = val + brightness;
          val = (val - 128) * (contrast / 100 + 1) + 128;
          val += exposure;
          data[i + j] = val;
        }

        // Tone curve adjustments
        data[i + 0] = Math.min(255, Math.max(0, data[i + 0] + curveR));
        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + curveG));
        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + curveB));
      }

      ctx.putImageData(imageData, 0, 0);
    }
  </script>
</body>
</html>
